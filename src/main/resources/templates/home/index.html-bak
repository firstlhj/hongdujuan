<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>主页</title>
    <div th:replace="shared/layout_header"></div>

    <style>
        button {
            border: none;
            padding: 0;
        }

        img {
            width: 100%;
        }

        .content {
            width: 100%;
        }

        #confirmOrder {
            margin-top: -5px;
            margin-bottom: -5px;
        }
    </style>

</head>
<body>

<div class="content">
    <img src="/image/home_01.jpg" alt="part_1"/>
    <img id="confirmOrder" src="/image/home_02.jpg" alt="我要认种"/>
    <img src="/image/home_03.jpg" alt="part_3"/>
</div>

<button id="share" style="display: none">分享到朋友圈</button>
</body>

<div th:replace="shared/layout_scripts"></div>
<script src="http://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script>
<script>
    $(function () {
        const params = {};

        // 授权验证js api
        $.ajax({
            type: "post",
            dataType: 'json',
            url: "/jspai/getConfig",
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify(params),
            success: function (res) {
                if (res.code) {
                    wx.config({
                        debug: true,
                        jsApiList: ['updateTimelineShareData'],
                        ...res.data,
                    });

                    wx.ready(function () {
                        wx.checkJsApi({
                            jsApiList: ['updateTimelineShareData'], // 需要检测的JS接口列表
                            success: function (res) {
                                // 以键值对的形式返回，可用的api值true，不可用为false

                                if (res.checkResult.updateTimelineShareData) {
                                    // 分享接口不可用，隐藏分享按钮
                                    $("#share").show();
                                }
                            }
                        });
                    });
                } else {
                    // layer.alert(res.msg, {icon: 2});
                }
            }
        });

        // 下单按钮
        $("#confirmOrder").click(function () {

            const orderData = {
                productCode: "001"
            };

            $.ajax({
                type: "post",
                dataType: 'json',
                url: "/order/create",
                contentType: "application/json;charset=utf-8",
                data: JSON.stringify(orderData),
                success: function (res) {
                    if (res.code) {
                        // 下单成功跳转支付
                        location.href = "/pay/index";
                    } else {
                        layer.alert(res.msg, {icon: 2});
                    }
                }
            });
        });

        // 分享按钮
        $("#share").click(function () {
            wx.updateTimelineShareData({
                title: '种植红杜鹃', // 分享标题
                link: location.href, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
                imgUrl: '', // 分享图标
                success: function () {
                    // 设置成功
                    layer.msg('分享成功', {icon: 1});
                }
            })
        });

    })
</script>
</html>